Instrumentation and replay for MSP430 based microcontrollers
============================================================

Folder structure
----------------
examples: example ELF files
lib: libraries

Libraries
---------
lib/tracing.py: common classes and functions
lib/elffile: library for elf files, originally from https://bitbucket.org/krp/elffile
lib/coding: library used in elffile, originally from https://bitbucket.org/krp/coding

Main tools
----------
  add_gpio_fun.py: instruments a given ELF file
  gpio2marker.py: converts a recorded GPIO trace to program addresses

Intrumentation
--------------
Usage: add_gpio_fun.py objfile [list of entry points]

Options:
  -h, --help            show this help message and exit
  -m TIME_METHOD, --method=TIME_METHOD
  -U, --uniquemarkers
  -u, --nouniquemarkers
  -C, --cfguniquemarkers
  -c, --nocfguniquemarkers
  -t CPU_SPEED_ERROR, --tolerance=CPU_SPEED_ERROR
  -b BOUNDFILE, --boundtrace=BOUNDFILE
  -l, --handleloops 

Example:
add_gpio_fun.py examples/tinyos_blink.elf
Ouput (in the same directory as the original file):
tinyos_blink.elf.bbcycles   basic blocks with annotated cycle count
tinyos_blink.elf.cycles     cycles and type for each instruction
tinyos_blink.elf.loopbounds 
tinyos_blink.elf.lut        lookup table for replay (used for debugging)
tinyos_blink.elf.markers    information about added witnesses (address, ID, ..)
tinyos_blink.elf.mod.elf    instrumented binary
tinyos_blink.elf.pickle     program structure and witness information used when replaying (python pickled)
tinyos_blink.elf.pickle2    program structure and witness information used when replaying (python pickled)

Replay
------
Usage: gpio2marker.py gpiotracefile elffile

Options:
  -h, --help            show this help message and exit
  -s STARTTIME, --start=STARTTIME
  -e ENDTIME, --end=ENDTIME
  -O, --stdin           
  -t, --tracefile       
  -b, --binarytracefile

This script expects the pickle files to be stored in the same structure as it is generated by the instrumentation (i.e. in the same directory as the original elf).

Limitations
-----------
We tested these tools using msp430-gcc version 4.6.3 20120301. It might work with other compilers.
Depnding on the compiler, some code structures might only be handled partially, e.g. case switches in C.

Prerequisites
-------------
Python 3.4.3
networkx 1.11
